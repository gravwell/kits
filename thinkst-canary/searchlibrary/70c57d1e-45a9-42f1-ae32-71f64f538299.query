tag=$CANARY_AUDIT json timestamp action_type user user_ip message flock_id flock_name
| eval in(action_type,
    "user_login"
    )
| regex -e message "(?<operation>log\w+\s\w+)"
| ip user_ip
| geoip user_ip.Location user_ip.City user_ip.Country user_ip.CountryName
| eval (Country!="US"||CountryName!="United States")
| printf -e context "at %v, %v %v via %v action from %v in %v, %v (%v)" timestamp user operation action_type user_ip City Country CountryName
| $CANARY_ALERT_META("Canary"," User Management", "High", "Successful Login from Outside Country")